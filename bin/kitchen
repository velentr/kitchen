#!/usr/bin/env ruby

# frozen_string_literal: true

APP_PATH = File.expand_path('../lib/config/application', __dir__)

require 'rails/command'

Rails::Command.invoke 'db:prepare', ARGV

# Rails annoyingly wnats to write to APP_PATH/tmp if we invoke the
# 'server' command; on guix, this path is readonly. Bypass rails
# entirely, since puma doesn't require writing here.
exec 'puma', '--environment', ENV['RAILS_ENV'] || 'development',
     File.expand_path('../../config.ru', APP_PATH)
